<html>
<head>
<meta charset="utf-8">
</head>
<body>
<div><center><h1>Загрузка игры...</h1></center></div>
<script src="https://unpkg.com/@vkontakte/vk-bridge@2.7.0/dist/browser.min.js"></script>
<script type="module">
vkBridge.send("VRWebInit", {});
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyACmlEQVkza9rKb6g8pYuT4q5ucHbmDPWM",
    authDomain: "social-mechanics.firebaseapp.com",
    projectId: "social-mechanics",
    storageBucket: "social-mechanics.appspot.com",
    messagingSenderId: "694583733644",
    appId: "1:694583733644:web:34bf909e592578a769faa9"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  import { getDatabase, ref, child, get, set } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
const startParams = new URLSearchParams(window.location.search);
let userId = startParams.get("user_id");
window.userId = startParams.get("user_id");
const dbRef = ref(getDatabase());
get(child(dbRef, userId+"/state")).then((snapshot) => {
  if (snapshot.exists()) {
    if (snapshot.val() == "2"){
	    console.log("Star");
vkBridge.send('VKWebAppAddToFavorites')
  .then((data) => { 
    if (data.result) {
	    console.log("OK");
      // Мини-приложение или игра добавлены в избранное
    }
  })
  .catch((error) => {
	console.log("error");
    // Ошибка
  });
	    			 const db = getDatabase();
	                     set(ref(db,userId+'/'), {
    state: "0",
  });
	} else {
	   				 const db = getDatabase();
                     set(ref(db,userId+'/'), {
    state: "2",
  });
	}
  } else {
    console.log("No data available");
	   				 const db = getDatabase();
                     set(ref(db,userId+'/'), {
    state: "1",
  });
  }
}).catch((error) => {
  console.error(error);
   				 const db = getDatabase();
                     set(ref(db,userId+'/'), {
    state: "1",
  });
});
</script>
<script type="module">
vkBridge.send("VRWebInit", {});
let text = "0";
const startParams = new URLSearchParams(window.location.search);
let userId = startParams.get("user_id");
text = userId;
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDGNzBLfw-BPwkZmWNZYDYXaPML7pITynY",
    authDomain: "counter-9e623.firebaseapp.com",
    projectId: "counter-9e623",
    storageBucket: "counter-9e623.appspot.com",
    messagingSenderId: "1088265826397",
    appId: "1:1088265826397:web:219f83f4a7d03462749db4"
  };

  // Initialize Firebase
  const app2 = initializeApp(firebaseConfig,"app2");
  import { getDatabase, ref, child, get, set} from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
  		 const dbref = ref(getDatabase(app2));
get(child(dbref,text+'/')).then((snapshot) => {
  if (snapshot.exists()) {
	  console.log("You started this app!");
  	try {
localStorage.setItem('id',text);
		console.log("browser support cookie! you be here!");
    window.location = 'startpagebe.html';
	 } catch (error) {
		  window.location = 'stlocalbe.html';
		console.log("browser do not support cookie! you be here!");
	 }

  } else {
	  console.log("do not be here!");
 				 const db = getDatabase();
                     set(ref(db,text+'/'), {
    state: "1",
  });
    	try {
localStorage.setItem('id',text);
window.location = 'startpagenotbe.html';
	 } catch (error) {
		   console.log("do not be here! Cookie do not saved!");
		  window.location = 'stlocalnotbe.html';
	 }
 
  }
}).catch((error) => {
    	try {
localStorage.setItem('id',text);
window.location = 'startpagenotbe.html';
	 } catch (error) {
		  window.location = 'stlocalnotbe.html';
	 }
 
});
</script>
</body>
</html>
